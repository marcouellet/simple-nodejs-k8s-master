on: push

name: npm build, lint, test and publish

jobs:

  build-and-publish:

    name: build and publish
    runs-on: ubuntu-latest

    steps:

      - name: checkout
        uses: actions/checkout@master

      - name: npm install
        uses: actions/setup-node@v2
          with:
            node-version: '14'
          - run: npm install
                
     - name: npm test
        uses: actions/setup-node@v2
          with:
            node-version: '14'
          - run: npm test

     - name: npm lint
        uses: actions/setup-node@v2
          with:
            node-version: '14'
          - run: npm lint

      - name: docker build
        uses: actions-hub/docker@master
          with:
            args: build -t marcouellet/simple-nodejs-k8s-master .

      - name: docker login
        uses: actions/docker/login@master
        env:
          DOCKER_PASSWORD: ${{ secrets.DOCKER_PASSWORD }}
          DOCKER_USERNAME: ${{ secrets.DOCKER_USERNAME }}

      - name: docker push
        uses: actions-hub/docker@master

          with:
            args: push marcouellet/simple-nodejs-k8s-master